<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>착공도서 자동생성 시스템</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>착공도서 자동생성 시스템</h1>
      <p>인테리어 착공도서 PPT를 쉽고 빠르게 제작하세요</p>
    </div>
    <div class="content">
      <div class="step">
        <h3>1단계: 파일 업로드</h3>
        <div class="upload-area" onclick="document.getElementById('excelFile').click()">
          <p>📊 스펙리스트 엑셀 파일 업로드</p>
          <button class="upload-btn">파일 선택</button>
          <input type="file" id="excelFile" accept=".xlsx,.xls" />
        </div>
        <div id="excelInfo" class="file-info" style="display:none;"></div>
        <div class="upload-area" onclick="document.getElementById('minimapFile').click()">
          <p>🗺️ 미니맵 이미지 업로드</p>
          <button class="upload-btn">파일 선택</button>
          <input type="file" id="minimapFile" accept="image/*" />
        </div>
        <div id="minimapInfo" class="file-info" style="display:none;"></div>
        <div class="upload-area" onclick="document.getElementById('sceneFiles').click()">
          <p>🏠 장면 이미지들 업로드 (다중 선택 가능)</p>
          <button class="upload-btn">파일 선택</button>
          <input type="file" id="sceneFiles" accept="image/*" multiple />
        </div>
        <div id="sceneInfo" class="file-info" style="display:none;"></div>
      </div>
      <div class="step" id="matchingStep" style="display:none;">
        <h3>2단계: 장면별 자재 선택 & 미니맵 위치 지정</h3>
        <div class="scene-container">
          <div class="scene-selector">
            <h4>장면 선택</h4>
            <div id="sceneSelector"></div>
          </div>
          <div class="material-workspace">
            <h4 id="currentSceneTitle">장면을 선택하세요</h4>
            <div id="minimapDrawWrap" style="display:none;margin:10px 0 20px 0;">
              <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px;">
                <div style="font-weight:600;">미니맵에서 빨간 박스로 해당 장면의 위치를 지정하세요</div>
                <div><button class="tab-button" id="resetBoxBtn" type="button">박스 초기화</button></div>
              </div>
              <div style="display:flex;gap:16px;align-items:flex-start;">
                <canvas id="minimapCanvas" width="420" height="300" style="border:1px solid #ddd;border-radius:8px;background:#fff;"></canvas>
                <div style="font-size:12px;color:#555;line-height:1.4;">
                  <div>• 마우스로 드래그하여 위치 박스를 그립니다.</div>
                  <div>• 장면마다 다른 위치를 저장합니다.</div>
                </div>
              </div>
            </div>
            <div id="materialTabFilter" style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
              <h5 style="margin-bottom: 10px;">자재 탭 필터링:</h5>
              <div id="materialTabButtons" style="display:flex;gap:10px;flex-wrap:wrap;"></div>
            </div>
            <div style="background:white;border:2px solid #ecf0f1;border-radius:8px;padding:10px;">
              <table style="width:100%;border-collapse:collapse;font-size:0.85em;">
                <thead>
                  <tr style="background:#f8f9fa;height:30px;">
                    <th style="border:1px solid #ddd;padding:5px;width:40px;font-size:0.8em;">#</th>
                    <th style="border:1px solid #ddd;padding:5px;width:120px;font-size:0.8em;">탭명</th>
                    <th style="border:1px solid #ddd;padding:5px;width:120px;font-size:0.8em;">MATERIAL</th>
                    <th style="border:1px solid #ddd;padding:5px;width:60px;font-size:0.8em;">AREA</th>
                    <th style="border:1px solid #ddd;padding:5px;font-size:0.8em;">ITEM</th>
                    <th style="border:1px solid #ddd;padding:5px;font-size:0.8em;">REMARKS</th>
                    <th style="border:1px solid #ddd;padding:5px;width:60px;font-size:0.8em;">이미지</th>
                    <th style="border:1px solid #ddd;padding:5px;width:50px;font-size:0.8em;">선택</th>
                  </tr>
                </thead>
                <tbody id="materialTableList"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="step" id="generateStep" style="display:none;">
        <h3>3단계: 착공도서 PPT 생성</h3>
        <button id="generateBtn" class="generate-btn">PPT 생성하기</button>
        <div id="progress" class="progress">
          <p>생성 중...</p>
          <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
        </div>
        <div id="status" class="status"></div>
        <div id="previewArea" style="display:none;margin-top:20px;">
          <h4>미리보기</h4>
          <div id="slidePreview" style="border:2px solid #ecf0f1;border-radius:10px;padding:20px;background:white;"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="app.js"></script>
</body>
</html>
